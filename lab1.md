This lab was completed using FlareVM on windows 11 in Oracle VirtualBox.
- Proceed with caution handling this file, contains live malware.

- Malware sample from: https://www.youtube.com/watch?v=idcvzyibrag&list=PLBf0hzazHTGMSlOI2HZGc08ePwut6A2Io&index=6&t=298s
- Link to sample: https://www.youtube.com/redirect?event=video_description&redir_token=QUFFLUhqbG1Xcng5b1lRWkh1blpDQTFOZXp2T3ViR2FyZ3xBQ3Jtc0trZVMyUjR5T3lqdmFYdFRrM2dNdnRwRTRzX0lBTUZpTlNSdlhfVnlyUWhlMkltSDFuM0ppY3ZsLWFSb1BpNXZubVBSNktoQ2hVZTl2b0VGUmExUUdmUXpCRFhjci12eU9JeDNKN0tQdkpObDA2cTVUTQ&q=https%3A%2F%2Fs3.eu-central-1.amazonaws.com%2Fdasmalwerk%2Fdownloads%2Fdc030778938b8b6f98236a709d0d18734c325accf44b12a55ecc2d56b8bb9000%2Fdc030778938b8b6f98236a709d0d18734c325accf44b12a55ecc2d56b8bb9000[.]zip&v=idcvzyibrag

- Checking the file in Hex editor we see that the file starting with MZ indicates that it is an executable to hide its extention.
![image](https://github.com/user-attachments/assets/7771739e-cbf6-4c43-9248-04475b8986f9)

- We can open the file with CFF Explorer to find more informaiton on the PE header
![image](https://github.com/user-attachments/assets/721c5527-bb51-4a56-96f8-d44434c0c686)

- PE Studio: Gives us all the information we need, os, file type: DLL, portable executable (4D 5A) OR (MZ)
![image](https://github.com/user-attachments/assets/98333f37-e7a6-46f2-9ff5-e4d5bf2cd3fb)

- HashMyFiles can give us a set of hash values for our file
![image](https://github.com/user-attachments/assets/e350edba-d7e0-4952-812a-6eb1d2c2b858)

- Strings app can reveal the hard coded strings in the file.
![image](https://github.com/user-attachments/assets/388850c2-4c55-413a-8a5c-030d50d98776)

- PEID: Examine the first bytes
![image](https://github.com/user-attachments/assets/5669fb73-ac83-48b2-953f-c31977dbad0f)

![image](https://github.com/user-attachments/assets/a5853a91-fab8-4c2f-9a28-659e97e18243)

- PEStudio can also be utilized to see the strings in a good format

- UPX to pack the file which obfuscates the strings making it difficult for the analyst
- EXEinfo PE can be used to identify how to unpack the saample
![image](https://github.com/user-attachments/assets/298932e7-4f9f-4e2a-b381-22fdf73e6874)
![image](https://github.com/user-attachments/assets/65c438e5-d8c7-45a7-8ea2-de2f43e79099)


- Yara Rules to detect this credential stealer

rule cred_ru
{
meta:
  description = "Simple YARA rule to detect russian credential stealer"

strings:
  $a = "http://leftthenhisper.ru/zapy/gate.php"
  $b = "http://reptertinrom.ru/zapy/gate.php"
  $c = "http://rninparqil.com/zapy/gate.php"
  $mz = {4D 5A}
  $POST = "HTTP"

conditions:
  ($a or $b or $c and $mz or $POST)
}
